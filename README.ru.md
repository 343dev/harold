# @funboxteam/harold

**harold** — CLI-утилита для создания «слепков» состояния файлов сборки проекта и сравнения ранее созданных «слепков».

В результате сравнения выводится отчёт, который содержит:

1. Разницу во времени сборки проекта.
2. Разницу в размере и количестве файлов по категориям (JS, CSS, Images и т. д.).
3. Общую разницу в размере и количестве всех файлов.
4. Пофайловое сравнение с информацией об удалённых, добавленных и изменённых файлах.

Размеры выводятся в виде обычного размера + размера в gzip, например: `758 kB (219 kB)`.

## Установка

```bash
npm i -g @funboxteam/harold
```

## Доступные команды

### snapshot \[options\]

Собирает проект, и создаёт слепок сборки.

Доступные флаги:

- `-o, --output <path>` — указывает путь, по которому нужно сохранить снэпшот, по умолчанию `harold_snapshot_<date>_<time>.json`;
- `-e, --exec <cmd>` — указывает команду для сборки проекта, по умолчанию `NO_HASH=true npm run build-production`;
- `-p, --path <path>` — указывает путь до директории, в которую будет собран проект, по умолчанию `public`.

### diff \<left\> \<right\>

Сравнивает предоставленные слепки.

### help

Предоставляет справку по командам.

## Примеры использования

```bash
# Переходим в директорию проекта
cd ~/my-syper-kewl-project/

# Делаем снэпшот
harold snapshot -o before.json

# Как-то изменяем проект

# Делаем ещё снэпшот
harold snapshot -o after.json

# Сравниваем снэпшоты
harold diff before.json after.json
```

## Пример результата сравнения

Сравнение проекта до обновления зависимостей и после:

```
❯ harold diff before.json after.json

Snapshots:
 Left: 11/10/2020 6:30:56 PM • my-syper-kewl-project • master
 Right: 11/10/2020 6:45:13 PM • my-syper-kewl-project • improvement/framework-update

Build time:
 16 seconds slower (Left: 129 seconds, Right: 145 seconds)

Diff by category:
 ————————————————————————————————————————————————————————————————————————————————————
                before              after               Changes
 ————————————————————————————————————————————————————————————————————————————————————
  JS            1.04 MB (270 kB)    1.12 MB (294 kB)    +78.2 kB (+23.7 kB), +1 item
 ————————————————————————————————————————————————————————————————————————————————————
  JS (legacy)   1.07 MB (285 kB)    1.16 MB (314 kB)    +90.6 kB (+28.6 kB), +1 item
 ————————————————————————————————————————————————————————————————————————————————————
  CSS           144 kB (23.4 kB)    144 kB (23.4 kB)    No changes
 ————————————————————————————————————————————————————————————————————————————————————
  Images        5.26 MB (5.23 MB)   5.26 MB (5.23 MB)   No changes
 ————————————————————————————————————————————————————————————————————————————————————
  Fonts         159 kB (159 kB)     159 kB (159 kB)     No changes
 ————————————————————————————————————————————————————————————————————————————————————
  Videos        1.59 MB (1.58 MB)   1.59 MB (1.58 MB)   No changes
 ————————————————————————————————————————————————————————————————————————————————————
  Other         127 kB (13.2 kB)    127 kB (13.3 kB)    +364 B (+82 B)
 ————————————————————————————————————————————————————————————————————————————————————

  Total         9.4 MB (7.56 MB)    9.57 MB (7.61 MB)   +169 kB (+52.4 kB), +2 items
 ————————————————————————————————————————————————————————————————————————————————————

Diff by files:
 m public: +169 kB (+52.4 kB)
 m public/10.js: +16 B (+4 B)
 m public/11.js: -20 B (-3 B)
 + public/12.js: 301 B (143 B)
 m public/3.js: +1.84 kB (+621 B)
 m public/app.js: +4.18 kB (+843 B)
 m public/legacy.10.js: +42 B (+18 B)
 + public/legacy.12.js: 513 B (148 B)
 m public/legacy.3.js: +1.9 kB (+634 B)
 m public/legacy.app.js: +6.83 kB (+1 kB)
 m public/legacy.vendor.js: +81.3 kB (+26.8 kB)
 m public/legacy.vendor.js.LICENSE: +182 B (+41 B)
 m public/vendor.js: +72.2 kB (+22.1 kB)
 m public/vendor.js.LICENSE: +182 B (+41 B)
```
